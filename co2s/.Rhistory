help(ccm)
MTS::ccm(da[,c("gdp","rate")])
forcast::ndiffs(da[,"gdp"])
forcat::ndiffs(da[,"gdp"])
forecat::ndiffs(da[,"gdp"])
forecast::ndiffs(da[,"gdp"])
forecast::ndiffs(da[,"rate"])
plot.ts(diff(da[,"gdp"], da[",rate"]))
plot.ts(diff(da[,"gdp"]), da[",rate"])
plot(diff(da[,c("gdp","rate)])
plot(diff(da[,c("gdp","rate")])
plot(diff(da[,c("gdp","rate")]))
x = cbind(diff(da$gdp), diff(da$rate))
x = cbind(diff(da$gdp)), diff(da$rate))
x = cbind(diff(da$gdp), diff(da$rate))
x = cbind(diff(da[,"gdp"]), diff(da[,"rate"]))
MTS::ccm(x, lag = 10)
ccf(x)
ccf(diff(da[,"gdp"]), diff(da[,"rate"]))
# sample cross correlation of first difference of gdp and unemployment rate
ccf(diff(da[,"gdp"]), diff(da[,"rate"]))
plot(diff(da[,c("gdp","rate")]))
x = cbind(diff(da[,"rate"]), diff(da[,"rgdp"]))
plot(diff(da[,c("rate","gdp")]))
x = cbind(diff(da[,"gdp"]), diff(da[,"rate"]))
x = cbind(diff(da[,"rate"]), diff(da[,"gdp"]))
ccf(diff(da[,"rate"]), diff(da[,"gdp"]))
MTS::ccm(x, lag = 10)
ccf(diff(da[,"gdp"]), diff(da[,"rate"]))
MTS::ccm(x, lag = 10)
ccf(diff(da[,"gdp"]), diff(da[,"rate"]))
MTS::mq(x, lag = 10)
plot(diff(da[,c("rate","gdp")]))
x = cbind(diff(da[,"rate"]), diff(da[,"gdp"]))
MTS::mq(x, lag = 10)
help(mq)
x=matrix(rnorm(1500),500,3)
mq(x)
MTS::mq(x, lag = 10)
setwd("/media/kswada/MyFiles/R/R_basics")
packages <- c("dplyr", "MTS", "tseries", "forecast")
purrr::walk(packages, library, character.only = TRUE, warn.conflicts = FALSE)
C = matrix(c(0.8, 0.4, -0.3, 0.6), nrow = 2)
( C = matrix(c(0.8, 0.4, -0.3, 0.6), nrow = 2) )
( C = matrix(c(0.8, 0.4, -0.3, 0.6), ncol = 2) )
( S = matrix(c(2.0, 0.5, 0.5, 1.0), ncol = 2) )
n <- 300
m1 <- VARMAsim(300, arlags = c(1), phi = C, sigma = S)
zt <- m1$series
MTSplot(zt)
( zt <- m1$series )
ccm(zt)
help(ccm)
ccm(zt, lags = 5)
ccf(zt)
head(zt)
ccf(zt[,1], zt[,2])
help(ccf)
ccf(zt[,1], zt[,2], lag.max = 5)
ccf(zt[,1], zt[,2], lag.max = 5, type = "covariance")
ccf(zt[,1], zt[,2], lag.max = 5, type = "covariance")
ccf(zt[,1], zt[,2], lag.max = 5, type = "correlation")
ccf(zt[,1], zt[,2], lag.max = 5)
ccm(zt, lags = 5)
MTS::mq(zt, lag = 5)
MTS::mq(zt, lag = 10)
( C <- matrix(c(0.8, -0.3, 0.4, 0.6), ncol = 2) )
( S <- matrix(c(2.0, 0.5, 0.5, 1.0), ncol = 2) )
n <- 200
m2 <- VARMAsim(300, malags = c(1), phi = C, sigma = S)
( zt <- m2$series )
( C <- matrix(c(0.8, -0.3, 0.4, 0.6), ncol = 2) )
( S <- matrix(c(2.0, 0.5, 0.5, 1.0), ncol = 2) )
n <- 200
m2 <- VARMAsim(300, malags = c(1), theta = C, sigma = S)
( zt <- m2$series )
MTSplot(zt)
forecast::ndiffs(zt)
ccm(zt, lags = 2)
ccf(zt[,1], zt[,2], lag.max = 2)
ccm(zt, lags = 5)
ccf(zt[,1], zt[,2], lag.max = 5)
ccm(zt, lags = 5)
MTS::mq(zt, lag = 5)
MTS::mq(zt, lag = 2)
MTS::mq(zt, lag = 5)
( C <- matrix(c(0.8, -0.3, 0.4, 0.6), ncol = 2) )
( S <- matrix(c(2.0, 0.5, 0.5, 1.0), ncol = 2) )
n <- 300
m1 <- VARMAsim(300, arlags = c(1), phi = C, sigma = S)
( zt <- m1$series )
# ----------
MTSplot(zt)
# ------------------------------------------------------------------------------
# simulate VAR(1) time series:  z(t) = C * z(t-1) + a(t)
# where a(t) are iid bivariate normal random variates with mean zero and Cov(a(t)) = S
# ------------------------------------------------------------------------------
# obtain the first five lags of sample CCMs of z(t)
ccm(zt, lags = 5)
ccf(zt[,1], zt[,2], lag.max = 5)
MTS::mq(zt, lag = 10)
ccf(zt[,1], zt[,2], lag.max = 5)
forecast::Acf(zt)
forecast::Pacf(zt)
forecast::Acf(zt)
forecast::Acf(zt[,1)]
forecast::Acf(zt[,1])]
forecast::Acf(zt[,1])
forecast::Acf(zt[,2])
par(mfrow=c(2,1))
forecast::Acf(zt[,1])
forecast::Acf(zt[,2])
par(mfrow=c(1,1))
forecast::Acf(zt)
help("Acf")
tsdisplay(zt[,1])
tsdisplay(zt)
tsdisplay(zt)
graphics.off()
tsdisplay(zt)
par(mfrow=c(1,1))
forecast::Acf(zt)
da <- read.table(file = "/media/kswada/MyFiles/references/MultivariateTimeSeriesAnalysisWithRAndFinancialApplications/q-fdebt.txt", header = T)
glimpse(da)
str(da)
debt = log(da[,3:5])
debt <- log(da[, 3:4])
tdx <- da[,1] + da[,2] / 12
( debt <- log(da[, 3:4]) )
( tdx <- da[,1] + da[,2] / 12 )
MTSplot(debt, tdx)
graphics.off()
library(MTS)
MTSplot(debt, tdx)
MTSplot(debt)
plot.ts(debt)
zt <-diffM(debt)
MTSplot(zt, tdx[-1])
plot.ts(zt, tdx[-1])
head(tdx)
head(tdx[-1])
head(tdx[-2])
forecast::ndiffs(zt)
head(zt)
forecast::ndiffs(zt[,"hbfin"])
forecast::ndiffs(zt[,"hbfrbn"])
forecast::ndiffs(debt[,"hbfin"])
forecast::ndiffs(debt[,"hbfrbn"])
forecast::ndiffs(zt[,"hbfrbn"])
ccf(zt[,"hbfin"], zt[,"hbfrbn"])
graphics.off()
ccf(zt[,"hbfin"], zt[,"hbfrbn"])
graphics.off()
ccf(zt[,"hbfin"], zt[,"hbfrbn"])
MTS::ccm(zt, lag = 10)
MTS::mq(x, lag = 10)
graphics.off()
ccf(zt[,"hbfin"], zt[,"hbfrbn"])
ccf(debt[,"hbfin"], debt[,"hbfrbn"])
MTS::ccm(debt, lag = 10)
MTS::ccm(zt, lag = 10)
MTS::ccm(debt, lag = 10)
MTS::mq(x, lag = 20)
MTS::mq(x, lag = 20)
MTS::mq(x, lag = 10)
setwd("/media/kswada/MyFiles/R/q_ungdp_4812")
packages <- c("dplyr", "AER", "tseries", "forecast", "dynlm", "stargazer")
purrr::walk(packages, library, character.only = TRUE, warn.conflicts = FALSE)
da <- read.table(file = "/media/kswada/MyFiles/references/MultivariateTimeSeriesAnalysisWithRAndFinancialApplications/q-ungdp-4812.txt", header = T)
glimpse(da)
str(da)
da <- read.table(file = "/media/kswada/MyFiles/references/MultivariateTimeSeriesAnalysisWithRAndFinancialApplications/q-ungdp-4812.txt", header = T)
glimpse(da)
str(da)
car::some(da)
help(car)
??car
head(da)
tail(da)
da <- ts(da, start = c(1948, 1), end = c(2012, 4), frequency = 4)
plot.ts(da[,c("gdp","unemp")])
plot.ts(diff(da[,c("gdp","unemp")]))
library(MTS)
MTSplot(da[,c("gdp","unemp")])
setwd("/media/kswada/MyFiles/R/q_ungdp_4812")
packages <- c("dplyr", "AER", "tseries", "forecast", "dynlm", "stargazer")
purrr::walk(packages, library, character.only = TRUE, warn.conflicts = FALSE)
graphics.off()
par(cex = 1.4, mar = c(4,4,2,1), lwd = 1.6, mfrow=c(2,1))
forecast::Acf(da[,"gdp"], main = "", xlab = "(a) US GDP", ylab = "")
forecast::Acf(diff(da[,"usa"]), main = "", xlab = "(b) First Difference in US GDP", ylab = "")
graphics.off()
par(cex = 1.4, mar = c(4,4,2,1), lwd = 1.6, mfrow=c(2,1))
forecast::Acf(da[,"gdp"], main = "", xlab = "(a) US GDP", ylab = "")
forecast::Acf(diff(da[,"gdp"]), main = "", xlab = "(b) First Difference in US GDP", ylab = "")
graphics.off()
par(cex = 1.4, mar = c(4,4,2,1), lwd = 1.6, mfrow=c(2,1))
forecast::Acf(da[,"unemp"], main = "", xlab = "(a) US UNEMP", ylab = "")
forecast::Acf(diff(da[,"unemp"]), main = "", xlab = "(b) First Difference in US UNEMP", ylab = "")
ndiffs(da[,"gdp"])
df <- diff(da[,"gdp"])
graphics.off()
par(cex = 1.6, mar = c(4,4,2,2), lwd = 1.6, mfrow=c(2,1))
plot(df, ylab = "Difference in US GDP")
Acf(df, main = "")
ndiffs(da[,"gdp"])
ndiffs(da[,"unemp"])
m1 <- ar(diff(da[,"gdp"]), method = "mle")
m1$order
graphics.off()
par(cex = 1.4, mar = c(4,4,2,1), lwd = 1.6, mfrow=c(2,1))
forecast::Acf(da[,"gdp"], main = "", xlab = "(a) US GDP", ylab = "")
forecast::Acf(diff(da[,"gdp"]), main = "", xlab = "(b) First Difference in US GDP", ylab = "")
da <- read.table(file = "/media/kswada/MyFiles/references/MultivariateTimeSeriesAnalysisWithRAndFinancialApplications/q-ungdp-4812.txt", header = T)
glimpse(da)
str(da)
head(da)
m1 <- ar(diff(da[,"gdp"]), method = "mle")
m1$order
ndiffs(da[,"gdp"])
ndiffs(da[,"unemp"])
da <- read.table(file = "/media/kswada/MyFiles/references/MultivariateTimeSeriesAnalysisWithRAndFinancialApplications/q-ungdp-4812.txt", header = T)
m1 <- ar(diff(da[,"gdp"]), method = "mle")
m1$order
m2 <- ar(diff(da[,"unemp"]), method = "mle")
m2$order
adfTest(da[,"gdp"], lags = 3)
adfTest(da[,"gdp"], lags = 3)
adfTest(da[,"gdp"], lags = 3, type = "c")
adfTest(da[,"gdp"], lags = 3, type = "ct")
adfTest(da[,"gdp"], lags = 3)
adfTest(da[,"gdp"], lags = 3, type = "c")
adfTest(da[,"gdp"], lags = 3, type = "ct")
adfTest(da[,"gdp"], lags = 3)
adfTest(da[,"gdp"], lags = 3, type = "c")
adfTest(da[,"gdp"], lags = 3, type = "ct")
# ------------------------------------------------------------------------------
# ------------------------------------------------------------------------------
setwd("/media/kswada/MyFiles/R/usmacro")
packages <- c("dplyr", "AER", "lmtest", "stargazer", "dynlm", "broom", "knitr")
purrr::walk(packages, library, character.only = TRUE, warn.conflicts = FALSE)
# ------------------------------------------------------------------------------
# data:  usmacro
#
# u:  U.S. unemployment rate over a period of more than six decades
# g:  U.S. growth rate
# ------------------------------------------------------------------------------
data("usmacro", package = "POE5Rdata")
data <- usmacro
glimpse(data)
str(data)
is.ts(usmacro)
u.ts <- ts(usmacro$u, start = c(1948, 1), end = c(2016, 1), frequency = 4)
g.ts <- ts(usmacro$g, start = c(1948, 1), end = c(2016, 1), frequency = 4)
u1 <- stats::lag(u.ts, -1)
u2 <- stats::lag(u.ts, -2)
g1 <- stats::lag(g.ts, -1)
df <- ts.union(u.ts, u1, u2, g1)
us.lm <- lm(u.ts ~ u1 + u2 + g1, data = df)
summary(us.lm)
uArima <- Arima(u.ts, order = c(2, 0, 0), xreg = stats::lag(g.ts, -1))
uf <- forecast(uArima, xreg = c(g.ts[length(g.ts)], 0.869, 1.069), level = 95)
# ----------
tbl <- data.frame(uf)
kable(tbl, digits = 3, caption = "Unemployment Forecasts with Arima")
bics <- matrix(0, nrow = 9, ncol = 8)
# use dynlm()
for(p in 1:8){
ari <- dynlm(u ~ L(u, 1:p), data = us.ts)
SSE <- sum(residuals(ari)^2)
N <- nobs(ari)
K <- N - ari$df.residual
bics[1,p] <- log(SSE/N) + K * log(N) / N
}
for(p in 1:8){
for(q in 1:8){
ari <- dynlm(u ~ L(u, 1:p) + L(g, 1:q), data = us.ts)
SSE <- sum(residuals(ari)^2)
N <- nobs(ari)
K <- N - ari$df.residual
bics[1+q,p] <- log(SSE/N) + K * log(N) / N
}
}
tbl <- data.frame(cbind(0:8, bics))
names(tbl) <- c("q/p", 1:8)
kable(tbl, digits = 3, align = "c", caption = "Lag Order Selection for an AR Model")
tbl <- data.frame(cbind(0:8, bics))
names(tbl) <- c("q/p", 1:8)
kable(tbl, digits = 3, align = "c", caption = "Lag Order Selection for an AR Model")
mOpt <- which(bics == min(bics), arr.ind=TRUE)
cat("Optimal model: p ~ ", mOpt[[2]], ", q = ", mOpt[[1]] - 1)
Acf(us.ts[,"u"])
Acf(us.ts[,"g"])
setwd("/media/kswada/MyFiles/R")
packages <- c("dplyr", "Hmisc", "rms", "caret", "corrplot", "lattice", "ggplot2", "effects")
purrr::walk(packages, library, character.only = TRUE, warn.conflicts = FALSE)
library(car)
describe(Cowles)
mod.cowles <- glm(volunteer ~ sex + neuroticism*extraversion, data=Cowles, family=binomial)
eff.cowles <- allEffects(mod.cowles, xlevels=list(extraversion=seq(0, 24, 6)), fixed.predictors=list(given.values=c(sexmale=0.5)))
eff.cowles[[1]]
eff.cowles[[2]]
as.data.frame(eff.cowles[[2]])
plot(eff.cowles, "sex", axes=list(y=list(lab="Prob(Volunteer)")))
describe(Cowles)
car::some(Cowles)
mod.cowles <- glm(volunteer ~ sex + neuroticism*extraversion, data=Cowles, family=binomial)
mod.cowles <- glm(volunteer ~ sex + neuroticism*extraversion, data=Cowles, family=binomial)
summry(cowles)
summary(cowles)
summary(mod.cowles)
eff.cowles <- allEffects(mod.cowles, xlevels=list(extraversion=seq(0, 24, 6)), fixed.predictors=list(given.values=c(sexmale=0.5)))
eff.cowles[[1]]
eff.cowles[[2]]
eff.cowles[[2]]
eff.cowles[[1]]
eff.cowles[[2]]
plot(eff.cowles, "sex", axes=list(y=list(lab="Prob(Volunteer)")))
plot(eff.cowles, "neuroticism:extraversion",
axes=list(y=list(lab="Prob(Volunteer)", ticks=list(at=c(.1,.25,.5,.75,.9)))))
plot(Effect(c("neuroticism", "extraversion"), mod.cowles,
confint=list(type="Scheffe"),
xlevels=list(extraversion=seq(0, 24, 6)),
fixed.predictors=list(given.values=c(sexmale=0.5))),
axes=list(y=list(lab="Prob(Volunteer)", ticks=list(at=c(.1,.25,.5,.75,.9)))))
mod <- lm(prestige ~ type*(education + income + women), Prestige)
summary(mod)
plot(predictorEffects(mod, ~income))
eff2 <- effect("colour:age", mod, xlevels=list(age=15:45))
eff2
plot(eff2, rescale.axis=FALSE, multiline=TRUE, ylab="Probability(released)", rug=FALSE)
rm(list=ls())
graphics.off()
setwd("//media//kswada//MyFiles//R//heger_priede")
packages <- c("dplyr", "lattice")
purrr::walk(packages, library, character.only = TRUE, warn.conflicts = FALSE)
# ------------------------------------------------------------------------------
# data:  Heger Priede
#   - data from Heger et al. (2008) who looked at deep-sea pelagic bioluminescence (light omission of a living organism) in the summer of 2004
#     during a voyage of the research vessel G.O.Sars from the Azores to Iceland.
#   - A camera mounted on a so-called lander, connected to the boat with a winch cable (Priede et al. 2006), was lowered through the water column.
#     As the system descended, any potentially bioluminescent organisms striking against, or passing through, a mesh screeen were mecahnically stimulated,
#     and light output was recorded. Depth, temperature, salinity, oxygen, and fluorescence levels were measured.
# ------------------------------------------------------------------------------
BL <- read.table(file = "//media//kswada//MyFiles//references//ZuurBeginnersGuideToGeneralizedAdditiveModelsWithR//HegerPriede.txt", header = TRUE)
str(BL)
names(BL)
# no missing value
colSums(is.na(BL))
# ------------------------------------------------------------------------------
# relationship between Sources and Depth
# ------------------------------------------------------------------------------
# The data were sampled at 14 tstations, but in the beginning our analysis we will ignore any potential station effects.
# scatterplot of depth in metres versus bioluminescence counts per cubic meter (called "Sources" in the data file)
# Scale Depth
BL$DepthOriginal <- BL$Depth
BL$Depth <- BL$Depth/max(BL$Depth)
par(mfrow=c(1,2))
plot(x = BL$DepthOriginal, y = BL$Sources, xlab = "Depth", ylab ="Sources",  cex.lab = 1.5)
plot(x = BL$Depth, y = BL$Sources, xlab = "Scaled depth", ylab ="Sources",  cex.lab = 1.5, cex = 0.7,  pch = 16, col = grey(0.5))
# ------------------------------------------------------------------------------
# Assess collineartity
Mybwplot <- function(Z, MyVar, TargetVar){
#Multipanel boxplots
#Z: data set
#MyVar: character string
#TargetVar: variable for the x-axis..must be a factor
AllY <- as.vector(as.matrix(Z[,MyVar]))
AllX <- rep(Z[,TargetVar], length(MyVar))
ID <- rep(MyVar, each = nrow(Z))
P <- bwplot(AllY ~ factor(AllX) | ID, horizontal = FALSE,
ylab = "", xlab = "",
scales = list(alternating = T,cex.lab = 1.5,
x = list(relation = "same",rot =90, abbreviate = TRUE, cex = 1.5),
y = list(relation = "free", draw = FALSE)),
strip = strip.custom(bg = 'white',
par.strip.text = list(cex = 1.2)),
cex = .5,
par.settings = list(
box.rectangle = list(col = 1),
box.umbrella  = list(col = 1),
plot.symbol   = list(cex = .5, col = 1)))
print(P)
}
MyVar <- c("Sources", "Depth", "Temp", "Salinity", "Oxgen", "flcugl")
Mybwplot(BL, MyVar, "Station")
M1 <- lm(Sources ~ Depth, data = BL)
print(summary(M1), digits = 2, signif.stars = FALSE)
par(mfrow=c(1,1))
plot(x = BL$Depth, y = BL$Sources, xlab = "Scaled depth", ylab ="Sources",  cex.lab = 1.5, cex = 0.7,  pch = 16, col = grey(0.5))
abline(M1, lwd = 5)
E1 <- rstandard(M1)
F1 <- fitted(M1)
par(mfrow=c(1,2), mar = c(5,5,2,2))
plot(x = F1, y = E1, xlab = "Fitted values",  ylab = "Residuals",  cex.lab = 1.5)
abline(h = 0, v = 0)
plot(x = BL$Depth, y = E1,  xlab = "Depth",  ylab = "Residuals",  cex.lab = 1.5)
abline(h = 0)
rk <- function(x,z) ((z-0.5)^2-1/12)*((x-0.5)^2-1/12)/4 -((abs(x-z)-0.5)^4 -0.5*(abs(x-z)-0.5)^2 +7/240)/24
x <- BL$Depth
x
xk <- QD[2:10]
xk <- QD[2:10]
probs <- seq(0, 1, length = 11)
QD    <- quantile(BL$Depth, probs)
QD
QD
xk <- QD[2:10]
xk
q <- length(xk) + 2  # including outer knots (first and last)
n <- length(x)
X <- matrix(1, n, q)
X[,2] <- x
x
xk
head(x)
head(xk)
X
head(X)
outer(x, xk, FUN=rk)
help(outer)
x <- 1:9; names(x) <- x
x
x %o% x
y <- 2:8; names(y) <- paste(y,":", sep = "")
outer(y, x, "^")
y
x
outer(month.abb, 1999:2003, FUN = "paste")
xtabs(~ family, data = data)
setwd("//media//kswada//MyFiles//R//donner")
packages <- c("dplyr", "vcd", "MASS", "datasets")
purrr::walk(packages, library, character.only = TRUE, warn.conflicts = FALSE)
# ------------------------------------------------------------------------------
# data:  Donner
# ------------------------------------------------------------------------------
data("Donner", package = "vcdExtra")
dim(Donner)
str(Donner)
car::some(Donner)
data <- Donner
data$survived <- factor(Donner$survived, labels = c("no", "yes"))
xtabs(~ family, data = data)
setwd("//media//kswada//MyFiles//R//donner")
packages <- c("dplyr", "vcd", "MASS", "datasets")
purrr::walk(packages, library, character.only = TRUE, warn.conflicts = FALSE)
data("Donner", package = "vcdExtra")
library(vcdExtra)
install.packages("vcdExtra")
data("Donner", package = "vcdExtra")
dim(Donner)
str(Donner)
car::some(Donner)
data <- Donner
data$survived <- factor(Donner$survived, labels = c("no", "yes"))
xtabs(~ family, data = data)
fam <- data$family
levels(fam)[c(3,4,6,7,9)] <- "Others"
fam <- factor(fam, levels(fam)[c(1, 2, 4:6, 3)])
data$family <- fam
xtabs(~ family, data = data)
fam <- data$family
levels(fam)[c(3,4,6,7,9)] <- "Others"
fam <- factor(fam, levels(fam)[c(1, 2, 4:6, 3)])
data$family <- fam
xtabs(~ family, data = data)
graphics.off()
spineplot(xtabs(~ family + survived, data = data))
gpairs::gpairs(data[,c(4, 2, 3, 1)], diag.pars = list(fontsize = 20, hist.color = "gray"),
mosaic.pars = list(gp = shading_Friendly), outer.rot = c(45, 45))
install.packages("gpairs",dep=T)
gpairs::gpairs(data[,c(4, 2, 3, 1)], diag.pars = list(fontsize = 20, hist.color = "gray"),
mosaic.pars = list(gp = shading_Friendly), outer.rot = c(45, 45))
graphics.off()
gg <- ggplot(data, aes(age, as.numeric(survived=="yes"), color = sex)) + ylab("Survived") + theme_bw() +
geom_point(position = position_jitter(height = 0.02, width = 0))
# add conditional linear logistic regressions
gg + stat_smooth(method = "glm", method.args = list(family = "binomial"), formula = y ~ x, alpha = 0.2, size = 2, aes(fill = sex))
gg + stat_smooth(method = "loess", span=0.9, alpha = 0.2, size = 2, aes(fill = sex)) + coord_cartesian(ylim = c(-.05, 1.05))
gg + stat_smooth(method = "glm", method.args = list(family = "binomial"), formula = y ~ poly(x,2), alpha = 0.2, size = 2, aes(fill = sex))
donner.mod1 <- glm(survived ~ age + sex, data = data, family = binomial)
donner.mod2 <- glm(survived ~ age * sex, data = data, family = binomial)
car::Anova(donner.mod1)
car::Anova(donner.mod2)
library(splines)
donner.mod5 <- glm(survived ~ ns(age,2) * sex, data = data, family = binomial)
donner.mod6 <- glm(survived ~ ns(age,4) * sex, data = data, family = binomial)
car::Anova(donner.mod5)
car::Anova(donner.mod6)
# ----------
# With four more parameters, donner.mod6 fits better and has a smaller AIC.
vcdExtra::LRstats(donner.mod4, donner.mod5, donner.mod6)
donner.eff6 <- effects::allEffects(donner.mod6, xlevels = list(age=seq(0, 50, 5)))
plot(donner.eff6, ticks = list(at=c(0.001, 0.01, 0.05, 0.1, 0.25, 0.5, 0.75, 0.9, 0.95, 0.99, 0.999)))
ns(data$age,4)
attr(ns(data$age,4), "knots")
head(dat$age)
head(data$age)
head(ns(data$age,4))
1 + (23-7.25)*0.75 + (23-20.50)*0.18 + (23-28)*0.09 + (23-50)*(-0.05)
1 + (23-1)*0.75 + (23-7.25)*0.18 + (23-20.5)*0.09 + (23-28)*(-0.05)
1 + (23)*0.75 + (23-7.25)*0.18 + (23-20.5)*0.09 + (23-28)*(-0.05)
1 + (23)*0.7469 + (23-7.25)*0.1807 + (23-20.5)*0.0918 + (23-28)*(-0.04919)
1 + (23-7.25)*0.75 + (23-20.50)*0.18 + (23-28)*0.09 + (23-70)*(-0.05)
help(ns)
car::crPlots(donner.mod1, ~ age, smooth = list(span = 0.5),
id = TRUE, showLabels = list(method=list(abs(residuals(donner.mod1, type="pearson")), "x"), n=2, cex=1, col=car::carPalette()[1], location="lr"))
car::crPlots(donner.mod3, ~ poly(age,2), smooth = list(span = 0.5),
id = TRUE, showLabels = list(method=list(abs(residuals(donner.mod1, type="pearson")), "x"), n=2, cex=1, col=car::carPalette()[1], location="lr"))
col <- ifelse(data$survived == "yes", "blue", "red")
pch <- ifelse(data$sex == "Male", 16, 17)
car::avPlots(donner.mod1, id = TRUE, col = col, pch = pch, col.lines = "darkgreen")
